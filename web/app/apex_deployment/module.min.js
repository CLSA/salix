define(function(){"use strict";try{var module=cenozoApp.module("apex_deployment",true)}catch(err){console.warn(err);return}angular.extend(module,{identifier:{parent:{subject:"apex_scan",column:"apex_scan.id"}},name:{singular:"apex deployment",plural:"apex deployments",possessive:"apex deployment's",pluralPossessive:"apex deployments'"},columnList:{uid:{column:"participant.uid",title:"Participant"},rank:{column:"apex_exam.rank",title:"Wave Rank",type:"rank"},barcode:{column:"apex_exam.barcode",title:"Barcode"},scan_type_side:{title:"Scan Type"},apex_host:{column:"apex_host.name",title:"Apex Host"},merged:{title:"Merged",type:"boolean"},status:{title:"Status"},priority:{column:"apex_scan.priority",title:"Priority",type:"boolean"},pass:{title:"pass"},code_summary:{column:"apex_deployment_code_summary.summary",title:"Code Summary"}},defaultOrder:{column:"apex_host.id",reverse:false}});module.addInputGroup("",{apex_host_id:{title:"Apex Host",type:"enum",constant:true},uid:{column:"participant.uid",title:"Participant",type:"string",constant:true},barcode:{column:"apex_exam.barcode",title:"Barcode",type:"string",constant:true},rank:{column:"apex_exam.rank",title:"Wave Rank",type:"string",constant:true},scan_type_side:{column:"scan_type_side",title:"Scan Type & Side",type:"string",constant:true},pass:{type:"boolean",exclude:true},note:{type:"hidden"}});module.addInputGroup("Additional Details",{merged:{title:"Merged",type:"boolean",exclude:"add",constant:true},status:{title:"Status",type:"string",exclude:"add",constant:true},comp_scanid:{title:"Scan ID",exclude:"add",type:"string",constant:true},analysis_datetime:{title:"Analysis Date & Time",type:"datetime",exclude:"add",constant:true},export_datetime:{title:"Export Date & Time",type:"datetime",exclude:"add",constant:true},import_datetime:{title:"Import Date & Time",type:"datetime",exclude:"add",constant:true}});cenozo.providers.directive("cnApexDeploymentAdd",["CnApexDeploymentModelFactory",function(CnApexDeploymentModelFactory){return{templateUrl:module.getFileUrl("add.tpl.html"),restrict:"E",scope:{model:"=?"},controller:function($scope){if(angular.isUndefined($scope.model))$scope.model=CnApexDeploymentModelFactory.root}}}]);cenozo.providers.directive("cnApexDeploymentList",["CnApexDeploymentModelFactory",function(CnApexDeploymentModelFactory){return{templateUrl:module.getFileUrl("list.tpl.html"),restrict:"E",scope:{model:"=?"},controller:function($scope){if(angular.isUndefined($scope.model))$scope.model=CnApexDeploymentModelFactory.root}}}]);cenozo.providers.directive("cnApexDeploymentView",["CnApexDeploymentModelFactory",function(CnApexDeploymentModelFactory){return{templateUrl:module.getFileUrl("view.tpl.html"),restrict:"E",scope:{model:"=?"},controller:function($scope){if(angular.isUndefined($scope.model))$scope.model=CnApexDeploymentModelFactory.root;$scope.booleanEnumList=[{value:"",name:"(empty)"},{value:true,name:"Yes"},{value:false,name:"No"}];$scope.nextApexDeployment=function(){$scope.model.viewModel.transitionOnNextViewState()}}}}]);cenozo.providers.factory("CnApexDeploymentAddFactory",["CnBaseAddFactory",function(CnBaseAddFactory){var object=function(parentModel){CnBaseAddFactory.construct(this,parentModel)};return{instance:function(parentModel){return new object(parentModel)}}}]);cenozo.providers.factory("CnApexDeploymentListFactory",["CnBaseListFactory",function(CnBaseListFactory){var object=function(parentModel){CnBaseListFactory.construct(this,parentModel)};return{instance:function(parentModel){return new object(parentModel)}}}]);cenozo.providers.factory("CnApexDeploymentViewFactory",["CnBaseViewFactory","CnHttpFactory","CnSession","CnModalMessageFactory","CnModalConfirmFactory","$q","$state",function(CnBaseViewFactory,CnHttpFactory,CnSession,CnModalMessageFactory,CnModalConfirmFactory,$q,$state){var object=function(parentModel,root){var self=this;CnBaseViewFactory.construct(this,parentModel,root);this.isComplete=false;this.transitionOnNextViewState=function(){return CnHttpFactory.instance({path:"apex_host/"+self.record.apex_host_id+"/apex_deployment",data:{select:{column:"id"},modifier:{where:[{column:"status",operator:"=",value:"pending"}],order:[{"apex_scan.priority":true},{"apex_exam.rank":false}],limit:1}}}).get().then(function(response){if(0<response.data.length)return $state.go("apex_deployment.view",{identifier:response.data[0].id})})};this.deferred.promise.then(function(){if(angular.isDefined(self.apexDeploymentModel))self.apexDeploymentModel.listModel.heading="Sibling Apex Deployment List"});this.onView=function(force){return this.$$onView(force).then(function(){self.parentModel.getEditEnabled=null==self.record.status||"exported"==self.record.status?function(){return false}:function(){return self.parentModel.$$getEditEnabled()};return self.parentModel.metadata.getPromise().then(function(){self.isComplete=true;self.parentModel.metadata.codeTypeList.forEach(function(codeType){self.record["codeType"+codeType.id]=false});return CnHttpFactory.instance({path:"apex_deployment/"+self.record.id+"/code",data:{select:{column:["code_type_id"]}}}).query().then(function(response){response.data.forEach(function(code){self.record["codeType"+code.code_type_id]=true})})})})};this.patch=function(property){if(property.match(/^codeType/)){var newValue=self.record[property];var codeTypeId=property.replace(/^codeType/,"");if(newValue){return CnHttpFactory.instance({path:"code",data:{apex_deployment_id:self.record.id,code_type_id:codeTypeId,user_id:CnSession.user.id},onError:function(response){if(409!=response.status){self.record[property]=!self.record[property];CnModalMessageFactory.httpError(response)}}}).post()}else{return CnHttpFactory.instance({path:"code/apex_deployment_id="+self.record.id+";code_type_id="+codeTypeId,onError:function(response){if(404!=response.status){self.record[property]=!self.record[property];CnModalMessageFactory.httpError(response)}}}).delete()}}else{var promiseList=[];var codeList=[];var resetCodes=false;if("pass"==property&&""===self.record.pass){for(var column in self.record)if(column.match(/^codeType/)&&self.record[column])codeList.push(column);if(0<codeList.length){promiseList.push(CnModalConfirmFactory.instance({title:"Reset Codes",message:"Do you also wish to remove all codes associated with this deployment?"}).show().then(function(response){resetCodes=response}))}}return $q.all(promiseList).then(function(){var data={};data[property]=self.record[property];if(resetCodes)data.reset_codes=true;return self.onPatch(data).then(function(){if("pass"==property)return self.onView()})})}}};return{instance:function(parentModel,root){return new object(parentModel,root)}}}]);cenozo.providers.factory("CnApexDeploymentModelFactory",["CnBaseModelFactory","CnApexDeploymentAddFactory","CnApexDeploymentListFactory","CnApexDeploymentViewFactory","CnHttpFactory","$q",function(CnBaseModelFactory,CnApexDeploymentAddFactory,CnApexDeploymentListFactory,CnApexDeploymentViewFactory,CnHttpFactory,$q){var object=function(root){var self=this;CnBaseModelFactory.construct(this,module);this.addModel=CnApexDeploymentAddFactory.instance(this);this.listModel=CnApexDeploymentListFactory.instance(this);this.viewModel=CnApexDeploymentViewFactory.instance(this,root);this.getServiceData=function(type,columnRestrictLists){var data=this.$$getServiceData(type,columnRestrictLists);if("apex_deployment"==this.getSubjectFromState()&&"view"==this.getActionFromState())data.sibling_apex_deployment_id=self.getQueryParameter("identifier");return data};this.getMetadata=function(){return this.$$getMetadata().then(function(){return $q.all([CnHttpFactory.instance({path:"apex_host",data:{select:{column:["id","name"]},modifier:{order:{name:false}}}}).query().then(function success(response){self.metadata.columnList.apex_host_id.enumList=[];response.data.forEach(function(item){self.metadata.columnList.apex_host_id.enumList.push({value:item.id,name:item.name})})}),CnHttpFactory.instance({path:"code_type",data:{select:{column:["id","code","description"]},modifier:{order:"code"}}}).query().then(function(response){self.metadata.codeTypeList=response.data})])})}};return{root:new object(true),instance:function(){return new object(false)}}}])});
